@using FinanzasPersonales.Extensions
@model FinanzasPersonales.Models.User
@{
    var Telefono = User.Identity.GetPhoneNumber();
    var Email = User.Identity.GetEmail();
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
    ViewBag.Title = "Dashboard";
}

<div class="sideContet">
    <div class="row">
        <div class="col s12 m12">
            <div class="card">
                <div class="card-content grey lighten-5">
                    <span class="card-title">Balance</span>
                    <p>
                        RD$12000.00
                    </p>
                </div>
            </div>
        </div>
    </div>

@Html.Partial("_PruebaDataTable")

    <div id="frmNuevaTransaccion" class="modal bottom-sheet">
        <div class="modal-content">
            <h4>Nueva Transacción</h4>
            <div class="row">
                <div class=" col s12 m4">
                    <div class="row">
                        <div class="col s1">
                            <a href="#" id="contenedorFlechaTipoTransaccion" class="red-text"><i id="flechaTipoTransaccion" class="material-icons">arrow_upward</i><br><i class="material-icons">account_balance</i></a>
                        </div>
                        <div class="input-field col s11">
                            <input id="Monto" name="MontoEgreso" type="number"  step="0.01" class="validate">
                            <label for="Monto">Monto</label>
                        </div>
                    </div>
                    

              </div>
                <div class="col s12 m4">
                    <div class="row">
                        <label>Categoría&nbsp&nbsp</label><a href="#divNuevaCategoria" class="btn-floating waves-effect waves-green green modal-trigger"><i class="material-icons">add</i></a>

                    </div>
                    <div class="row">
                        <select id="cuentaObjetivo" name="CategoriaID" class="CategoriaSelect select2"></select>

                    </div>
                </div>
                <div class="col s12 m4">
                    <div class="row">
                        <label>Contacto&nbsp&nbsp</label><a href="#divNuevoContacto" class="btn-floating waves-effect waves-green green modal-trigger"><i class="material-icons">add</i></a>

                    </div>
                    <div class="row">
                        <select id="cuentaObjetivo" name="MonedaID" class="MonedaSelect select2"></select>

                    </div>
                </div>

            </div>
            <div class="row">
                <div class="input-field col s12 m4">
                    <input type="text" id="FechaTransaccion" name="Fecha" class="datepicker">
                    <label for="FechaTransaccion" data-error="wrong" data-success="right">Fecha de inicio</label>


                </div>
                <div class="col s12 m4">

                    <div class="row">
                        <label>Cuenta Objetivo</label>

                    </div>
                    <div class="row">
                        <select id="cuentaObjetivo" name="MonedaID" class="MonedaSelect select2"></select>

                    </div>
                </div>
                <div class="input-field col s12 m4">
                    <input id="NoRefExterno" name="No_Ref_Externo" type="text" class="validate">
                    <label for="NoRefExterno">Numero</label>
                </div>
                

            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action btnSubmitCuentaBanco modal-close waves-effect waves-green btn-flat green white-text">Guardar</a>
        </div>
    </div>
</div>
<div id="divNuevaCuentaBanco" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4><i class="material-icons">account_balance</i> Nueva Cuenta de banco</h4>
        <div class="divider"></div>
        <div class="row">
            <form class="col s12" id="frmNuevaCuentaBanco">
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input name="NumeroCuenta" id="NumeroCuenta" type="text" class="validate">
                        <label for="NumeroCuenta">Numero de cuenta <span class="red-text">*</span></label>
                    </div>

                </div>
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input id="BalanceInicial" step="0.01" name="BalanceInicial" type="number" class="validate">
                        <label for="BalanceInicial">Balance Inicial</label>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12 m6">
                        <input id="NombreTitular" value="@Model.Nombre" name="NombreTitular" type="text" class="validate">
                        <label for="NombreTitular">Nombre del Titular<span class="red-text">*</span></label>
                    </div>
                    <div class="input-field col s12 m6">
                        <input name="ApellidoTitular" value="@Model.Apellido" id="ApellidoTitular" type="text" class="validate">
                        <label for="ApellidoTitular">Apellido del Titular<span class="red-text">*</span></label>
                    </div>
                </div>
                <div class="row">
                    <div class=" col s12">
                        <div class="row">
                            <label>Estado</label>

                        </div>
                        <div class="row">
                            <select id="EstadoCuentaBancoID" name="EstadoCuentaBancoID" class="EstadoCuentaBancoSelect select2"></select>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class=" col s12">
                        <div class="row">
                            <label>Moneda</label>

                        </div>
                        <div class="row">
                            <select id="MonedaID" name="MonedaID" class="MonedaSelect select2"></select>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class=" col s12">
                        <div class="row">
                            <label>Banco   </label><a href="#divNuevoBanco" class="btn-floating waves-effect waves-green nuevoBanco green modal-trigger"><i class="material-icons">add</i></a>

                        </div>
                        <div class="row">
                            <select id="BancoID" name="BancoID" class="BancoSelect select2"></select>

                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <input type="text" id="FechaInicio" name="FechaInicio" class="datepicker">
                        <label for="FechaInicio" data-error="wrong" data-success="right">Fecha de inicio</label>

                    </div>
                </div>
                <div class="row">
                    <div class="input-field col s12">
                        <textarea id="Comentario" name="Comentario" class="materialize-textarea"></textarea>
                        <label for="Comentario">Comentario</label>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat red white-text">Cancelar</a>
        <a data-form="frmNuevaCuentaBanco" href="#!" class="modal-action btnSubmitCuentaBanco modal-close waves-effect waves-green btn-flat green white-text">Guardar</a>
    </div>
</div>
<div id="divNuevoBanco" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4><i class="material-icons">account_balance</i> Nuevo Banco</h4>
        <div class="divider"></div>
        <div class="row">
            <form class="col s12" id="frmNuevoBanco">
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input name="NombreBanco" id="NombreBanco" type="text" class="validate">
                        <label for="NombreBanco">Nombre del banco <span class="red-text">*</span></label>
                    </div>

                </div>
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input id="Pais" name="Pais" type="text" class="validate">
                        <label for="Pais">Pais <span class="red-text">*</span></label>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat red white-text">Cancelar</a>
        <a data-form="frmNuevoBanco" href="#!" class="modal-action btnSubmitBanco modal-close waves-effect waves-green btn-flat green white-text">Guardar</a>
    </div>
</div>
<div id="divNuevaCategoria" class="modal modal-fixed-footer">
    <div class="modal-content">
        <h4><i class="fa fa-plus-circle green-text" style="display: inline !important"></i> Nueva Categoría</h4>
        <div class="divider"></div>
        <div class="row">
            <form class="col s12" id="frmNuevaCategoría">
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input name="NombreBanco" id="NombreBanco" type="text" class="validate">
                        <label for="NombreBanco">Nombre del banco <span class="red-text">*</span></label>
                    </div>

                </div>
                <div class="row">
                    <div class="input-field col s12 m12">
                        <input id="Pais" name="Pais" type="text" class="validate">
                        <label for="Pais">Pais <span class="red-text">*</span></label>
                    </div>
                </div>

            </form>
        </div>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat red white-text">Cancelar</a>
        <a data-form="frmNuevoBanco" href="#!" class="modal-action btnSubmitBanco modal-close waves-effect waves-green btn-flat green white-text">Guardar</a>
    </div>
</div>
@section Scripts {
   <script>
       $(document).ready(function () {

           //TEMP Debe generarse 

           $("#contenedorFlechaTipoTransaccion").click(function () {
               
               if ($(this).hasClass("red-text")) {
                   $("#Monto").attr("name", "MontoIngreso");
                   $(this).removeClass("red-text");
                   $(this).addClass("green-text")
               } else {
                   $("#Monto").attr("name", "MontoEgreso");
                   $(this).removeClass("green-text");
                   $(this).addClass("red-text")
               }
               $("#flechaTipoTransaccion").toggleClass('flip');
           });

           //
           $("#tablaprueba").DataTable();
           cargarSelectMoneda();
           cargarSelectBanco();
           cargarSelectEstadoCuentaBanco();
           cargarCuentasBanco();
           $('.datepicker').pickadate({
               selectMonths: true, // Creates a dropdown to control month
               selectYears: 90, // Creates a dropdown of 15 years to control year,
               today: 'Today',
               clear: 'Clear',
               close: 'Ok',
               closeOnSelect: true, // Close upon selecting a date,
               format: 'mm/dd/yyyy'
           });
           $('.modal').modal();
           $(".select2").select2({ width: '100%' });

            //Preparar selects de moneda+-----
            function cargarSelectMoneda() {
                $(".MonedaSelect").empty();
                $(".MonedaSelet").append(
                    $("<option>", {
                        value: "",
                        disabled: "disabled",
                        selected: "selected",
                        html: "Selecciona una opcion"
                    })
                );
                var monedas = getMonedas();

                for (var i in monedas) {
                    moneda = monedas[i];
                    $(".MonedaSelect").append(
                        $("<option>", {
                            value: moneda.Value,
                            html: moneda.Text
                        }).data("codigo", moneda.Codigo)
                    );
                }
                $(".select2").select2({ width: '100%' });

            }
            function cargarSelectBanco() {
                $(".BancoSelect").empty();
                $(".BancoSelect").append(
                    $("<option>", {
                        value: "",
                        disabled: "disabled",
                        selected: "selected",
                        html: "Selecciona una opcion"
                    })
                );
                var bancos = getBancos();

                for (var i in bancos) {
                    banco = bancos[i];
                    $(".BancoSelect").append(
                        $("<option>", {
                            value: banco.Value,
                            html: banco.Text
                        })
                    );
                }
                $(".select2").select2({ width: '100%' });

            }
            function cargarSelectEstadoCuentaBanco() {
                $(".EstadoCuentaBancoSelect").empty();
                $(".EstadoCuentaBancoSelect").append(
                    $("<option>", {
                        value: "",
                        disabled: "disabled",
                        selected: "selected",
                        html: "Selecciona una opcion"
                    })
                );
                var estados = getEstadosCuentaBanco();

                for (var i in estados) {
                    estado = estados[i];
                    $(".EstadoCuentaBancoSelect").append(
                        $("<option>", {
                            value: estado.Value,
                            html: estado.Text
                        })
                    );
                }
                $(".select2").select2({ width: '100%' });

            }
            function cargarCuentasBanco() {
                $(".contenedorCuentaBanco").find(".CuentaBancoLi").remove();
                var cuentasDeBanco = getCuentasBanco();
                for (var i in cuentasDeBanco) {
                    var cuentaI = cuentasDeBanco[i];
                    $(".contenedorCuentaBanco").append(
                        $("<li>", {
                            class: "CuentaBancoLi"
                        }).data("CuentaBancoID", cuentaI.CuentaBancoID).append(
                            $("<a>", {
                                class: "waves-effect waves-green sideButton",
                                html: cuentaI.NumeroCuenta
                            })
                            )
                    )
                }
                //< li > <a href="#!" class="">Second</a></li >
            }
            $(".btnSubmitBanco").click(function () {
                var objeto = objectifyForm($("#" + $(this).data("form")));
                guardarBanco(objeto);
                $("#" + $(this).data("form"))[0].reset();
                cargarSelectBanco()
            });
            $(".btnSubmitCuentaBanco").click(function () {
                var objeto = objectifyForm($("#" + $(this).data("form")));
                guardarCuentaBanco(objeto);
                $("#" + $(this).data("form"))[0].reset();
                cargarCuentasBanco();
            });


            $(".sideButton").click(function () {
                $(this).css("color", "white");
                var that = $(this);
                setTimeout(function () { $(that).css("color", "#757575"); }, 500);
                $(this).children().each(function () {
                    var that = $(this);
                    $(this).css("color", "white");
                    setTimeout(function () { $(that).css("color", "#757575"); }, 500);

                });
            })
        });
    </script>
}


